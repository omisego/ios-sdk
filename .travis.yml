language: swift
osx_image: xcode9.4
cache:
  - cocoapods
env:
  matrix:
    - TEST_TYPE=iOS
    - TEST_TYPE=Lint
    - TEST_TYPE=CocoaPods
before_install:
- |
  if [ "$TEST_TYPE" = Lint ]; then
    brew update
  fi
install:
- |
  gem update --system --no-document
  bundle install
  if [ "$TEST_TYPE" = Lint ]; then
    brew install swiftlint || brew upgrade swiftlint
  elif [ "$TEST_TYPE" = CocoaPods ]; then
    pod repo update --silent
  fi
script:
- |
  if [ "$TEST_TYPE" = iOS ]; then
    set -o pipefail
    xcodebuild -workspace OmiseGO.xcworkspace -scheme "OmiseGO" -sdk iphonesimulator -destination "platform=iOS Simulator,name=iPhone 8" test | xcpretty -c
  elif [ "$TEST_TYPE" = Lint ]; then
    swiftlint lint --path Source --quiet
  elif [ "$TEST_TYPE" = CocoaPods ]; then
    pod lib lint
  fi
